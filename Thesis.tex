\documentclass[a4paper]{article}
\usepackage[12pt]{extsizes} % 
\usepackage{setspace}
\doublespacing
\usepackage[utf8]{inputenc}
\usepackage{setspace,amsmath}
\usepackage{mathtools}
\usepackage{pgfplots}
\usepackage{titlesec}
%\usepackage{harvard}
\usepackage[round]{natbib}
\usepackage{pdfpages}
\usepackage{tikz}
\usepackage{makecell}
\usepackage{amsthm}
\usepackage[shortlabels]{enumitem}
\usepackage{tikz}
\usepackage{multirow}
\usetikzlibrary{angles,quotes}
\usepackage{graphicx}
\usepackage[colorinlistoftodos]{todonotes}
\usepackage{xcolor,colortbl}
\usepackage{amssymb}
\usepackage{float}
\usepackage[section]{placeins}
\usepackage{breakcites}
\interfootnotelinepenalty=10000
\usepackage[makeroom]{cancel}
\usepackage{mathrsfs} % 
\newcommand\numberthis{\addtocounter{equation}{1}\tag{\theequation}}
%\addto\captionsrussian{\renewcommand{\figurename}{Fig.}}
\usepackage{amsmath,amsfonts,amssymb,amsthm,mathtools} 
\newcommand*{\hm}[1]{#1\nobreak\discretionary{}
{\hbox{$\mathsurround=0pt #1$}}{}}
\usepackage{graphicx}  % 
\graphicspath{{images/}{images2/}}  % 
\setlength\fboxsep{3pt} %  \fbox{} 
\setlength\fboxrule{1pt} % \fbox{}
\usepackage{wrapfig} % 
%\newenvironment{abstract}[0]{\small\rm
%	\begin{center}ABSTRACT
%		\\ \vspace{8pt}
%		\begin{minipage}{5.2in}\smalllineskip
%			\hspace{1pc}}{\end{minipage}\end{center}\vspace{-1pt}}
\newcommand{\prob}{\mathbb{P}}
\newcommand{\norma}{\mathcal{N}}
\newcommand{\expect}{\mathbb{E}}
\newcommand{\summa}{\sum_{i=1}^n}
\usepackage[left=25mm, top=20mm, right=25mm, bottom=20mm, nohead, footskip=10mm]{geometry} % 
\usepackage{tikz} % 
\newtheorem{theorem}{Theorem}
\newtheorem{corollary}{Corollary}[theorem]
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{proposition}[theorem]{Proposition}
\newtheorem{assumption}[theorem]{Assumption}
\newtheorem{definition}[theorem]{Definition}
%\let\cite = \citeasnoun
\title{To run with the hare and hunt with the hounds: Optimal recommendation system with competing sellers. \\ Master Thesis}
\date{}
\author{Danil Fedchenko\thanks{I am very grateful to Sergei Izmalkov for his help during the work on this project}}
\begin{document} % 
	\maketitle
	\begin{abstract}
		Many e-commerce platforms that connect buyers and sellers employ recommender systems to help customers find products and services. These systems may have several potential effects on strategies of competing sellers: on one hand, more people become aware of products, so sellers may sell more goods and benefit from the presence of the recommender system. On the other hand, at the same time, more people become aware of the competitor seller. The latter effect may intensify the price competition and may hurt sellers but, of course, benefit customers. However, many platforms charge firms for sales and as a result have the stakes in firms profits. Thus, by designing the recommender policy the platform should balance the pro-competitive care about customers and anti-competitive incentives to keep high prices. The main goal of this work is to study this trade-off in details. I am solving for an optimal recommender policy and investigate factors that may affect it.
	\end{abstract}
\newpage
\tableofcontents
\newpage
	\section{Introduction}
	\section{Literature review}
	
		This work is related to the strand of literature on recommender systems. The first prototype of modern recommender system has been created by Xerox Palo Alto Research Center in the late 1980-s early 1990-s and was described by  \cite{goldberg1992using}. This system has been called \textit{Tapestry} and has been designed in order to filter out a skyrocketing amount of the incoming emails. The system was trying to make the incoming stream of emails interesting for the particular person based on whether these emails were interesting for people whose interests are close to the interests of this person. Since that time many papers have been written that mainly explore the recommender systems from the Computer Science standpoint (see \cite{Beel2015r} for the recent survey). 
	
	
	
	
	
	One of the first papers which highlights the issue from the point of view of Economics is work by \cite{avery1999market}. \cite{avery1999market} considered the influence of the recommender system on choice regarding the consumption of good for the sequentially arriving agents.
		
		
		
	\cite{bergemann2006optimal} address the question of optimal pricing under the presence of recommender system.
	
	
	In the two papers mentioned above the authors assumed the recommendation strategy to be given and mainly just consider the impact of the recommender system on other strategic agents. 
	
	
	
	One of the first works that focus on design of optimal recommendation policy is the work by \cite{kremer2014}. The authors build a simple model with two alternatives which generate deterministic but \textit{ex-ante} unknown payoff. One of the alternatives is \textit{a priori} better, in the sense that the expected reward it generates is higher. The finite number of consumers arrive sequentially and each chooses between either of two alternatives. After the choice is made the consumer leaves forever. The platform accumulates reviews and commits to the recommendation policy it uses to make recommendations to the newcomers. \cite{kremer2014}, firstly, neatly in simple terms demonstrate why the full revelation policy may be suboptimal\footnote{Maybe the appearance of this paper and similar to that in 2014 was the reason why \textit{Amazon} decided to switch their recommendation policy from the fully revealing one.}. Secondly, the optimal recommender policy is derived which has a threshold nature. That is, \textit{a priori} better alternative is recommended if its quality turns out to be higher than the certain threshold. Otherwise, the other alternative is recommended, and then once both alternatives were tried the best one is recommended until the end. 
	
	
	
	
	Another relevant paper is that of \cite{che2015}. In the paper, a continuous flow of customers arrives, and each should choose between the good or an outside option. The quality of the good is exogenously predetermined but unknown. Customers who decide to consume the good send a noisy signal about its quality to the platform. The signal is noisy in the sense that even if the quality of the good is good the information about it reaches to the platform only with some probability (different from 1). The platform updates its beliefs about the quality and tailors a recommender policy contingent on the beliefs. Authors demonstrate that the full revelation policy is suboptimal and find the optimal policy which again has a threshold nature. Namely, once the platform receives the signal that the quality is good, it will recommend the good until the end. Otherwise, if no news arrives it is optimal to experiment with the risky alternative (recommend it) until the beliefs that its quality is good fall below the certain threshold. After that, the optimal policy prescribes to never recommend this alternative.
	
	
	
	
	\cite{papanastasiou2017} extend ideas developed by \cite{kremer2014} and \cite{che2015}, and build a dynamic, stochastic model. In their model, agents also arrive sequentially to the platform and should choose between two alternatives that generate stochastically exogenous payoff. The platform in the paper designs a recommendation policy. Although the optimal policy turns out to have a complicated form, authors demonstrate that in this case the full revelation policy is not the best one, and the optimal policy involves information obfuscation.
	
	Three papers mentioned above although address the question on optimal recommender policy, do not take into account the strategic nature of recommended alternatives.
	\cite{chen2016advertising} consider the informative role of recommender system on strategies of competing sellers and the equilibrium outcomes. They consider two sellers located at the extremes of Hotelling-like (\cite{harold1929stability}) linear city who are competing for the unit mass of customers, located in between. There is also a recommender system that receives a noisy information about each customer's location and can recommend one of the sellers to the customers. Although in this paper, the recommendation strategy is exogenous, the authors consider how the presence of the recommender system affects competition between sellers. In particular, they are looking at prices and advertising expenditure. The main finding of this paper is that the presence of the recommender system may fundamentally change the nature of competition. In particular, the authors demonstrate that with the recommender system prices and advertising expenditure switch from being strategic substitutes to strategic complements. This results in the fact that with recommender system sellers prefer to advertise less, relying more on advertising provided by the recommendation system (the authors called this effect \textit{advertising effect}). At the same time, prices with recommender system are lower (the authors called this effect \textit{competition effect}) which is the result of tougher competition. Interestingly, the total effect of recommender system on sellers profits becomes a result of an interplay between \textit{competition effect} and \textit{advertising effect}: for some values of parameters the sellers becomes worse-off with the presence of the recommender system, \textit{competition effect} dominates, while for other values the sellers benefit from ``free'' advertising provided by the platform.
	
	Another paper, which is closely related to the one mentioned previously is the paper by \cite{li2018recommender} (actually there are two quite different versions of this paper). In the two papers mentioned above, the qualities of goods were supposed to be equal and known \textit{ex-ante} to all parties which makes the type of differentiation considered to be purely horizontal.
	
	\cite{levin2009quality} add a vertical component, focusing on the sellers' decisions regarding the quality disclosure, although, in the framework without the recommender system. In the model which I consider, I firstly endogenise the recommendation strategy that the platform implements, and secondly, I am looking at the interplay between the recommendation policy and sellers' incentives to disclose the information about the goods' quality.
	
	\section{Model}
	The model I consider is similar to that considered by \cite{levin2009quality}, the difference is that I introduce a new player -- a platform which employs a recommender system (I will use words ``platform'' and ``recommender system'' interchangeably).
		
	
	There is a unit mass of heterogenous customers. Preferences of customer are characterized by the location of the customer on the unity interval. Two competing sellers (firms) which I will refer to $A$ and $B$, who locate at the extremes of the unit interval, are selling substitutable goods which they produce at equal marginal cost normalized to 0. Goods of each seller may have different quality which means that the customers with the same ``horizontal preference'' for the two sellers may derive different utility upon consuming goods of different sellers. Sellers are competing in prices which they set simultaneously. In addition, the sellers may costly disclose the information about the quality of their good prior to price setting. The recommender system observes prices and sellers' decisions regarding the quality disclosure, and makes recommendation to customers which seller to choose. In the baseline model I assume that the recommender system knows the exact location of the customer, lately this assumption is relaxed, and I consider the scenario when the recommender system receives a noisy signal regarding the customers' locations. Finally, the platform charges sellers a commission for sales according to a commission rate $\alpha$ which the platform can choose. 
	
	
	
	The solution concept is perfect Bayesian equilibrium, and all parties are assumed to be risk-neutral.
	
	
	
	The next three subsections describes formally all parties of my model.
	
	
	
	
	
	\subsection{Customers}
	Customer who locates at $x \in [0, 1]$ derives a net utility $$V + q_A - p_A - x$$ if  he buys the good at a price $p_A$ from the seller $A$ who locates at a point $0$, and net utility $$V + q_B - p_B - (1-x)$$ if  he buys the good at a price $p_B$ from the seller $B$ who locates at a point $1$. $V$ is assumed to be higher than $\frac{3}{2}$ to ensure that the market is fully covered in equilibrium, $q_A, q_B \in [0, 1]$ are the qualities of the goods. The outside option for the customers is zero, so they follow the recommendation if the expected net utility from buying the good from the recommended seller is higher than 0.
	
	
	
	Customers do not know about the sellers unless the recommender system recommends them.
	
	
	\subsection{Sellers}
	
	
	Prior to price-setting sellers privately learns the quality of their good and should decide whether to disclose this information to the platform or not. Upon disclosure the sellers bear cost $c$. Moreover, the sellers pay the platform commission from sales. That is, the seller's $i$ profit is given by the following formula
	$$\pi_i = (1-\alpha)p_i D_i - c d_i$$
	where $$d_i = \begin{cases}
	1, \text{ if sellers }i\text{ discloses }\\
	0, \text{ otherwise }
	\end{cases}$$ and $D_i$ is the demand on good $i$ which may be a function of prices and decisions regarding the information disclosure, and is determined by the recommender policy the platform employs.
	
	
	
	\subsection{Platform}
	
	The platform commits to the commission rate $\alpha$ and the recommender policy. The recommender policy specifies functions $r_A(x, p_A, p_B, d_A, d_B, q_A, q_B)$ and $r_B(x, p_A, p_B, d_A, d_B, q_A, q_B)$ which represents probabilities that the customer with location $x$ will be recommended the seller $A$ and $B$ respectively. The objective function of the platform is given by \begin{align}\label{pl_profit}
	\pi_P = \alpha(p_A D_A + p_B D_B) + \gamma CS
	\end{align}
	
	where $CS$ is a consumer surplus, $\gamma$ represents the platform's degree of consumer-orientedness. I assume that the maximum rate of commission the platform can charge the sellers is $\bar{\alpha} \in (0, 1)$, and $\gamma > \bar{\alpha}$.
	
	
	The goal of the platform is to choose the commission rate $\alpha$ and the recommender policy in order to maximize \eqref{pl_profit}.
	
	\subsection{Timing}
	The timing of the game looks as follows:
	\begin{enumerate}
		\item The platform commits to the commission rate $\alpha$ and the recommender policy.
		\item The sellers privately observes $q_A, q_B$ and decide whether to disclose it to the platform.
		\item The sellers simultaneously set prices.
		\item The platform observes prices and whether the sellers disclosed quality, and recommends sellers to customers. After that the payoffs are realized and the game ends.
	\end{enumerate}

	\section{Results}
	Firstly, I consider the case with observable qualities and without the recommender system. I need this comparison in order to demonstrate how and via which mechanisms the presence of the recommender system affects equilibrium behavior of sellers.
	
	
	\subsection{Observable qualities. Without the platform}

	\begin{lemma}\label{without}
		If qualities $q_A$ and $q_B$ are observable then the demand for each good and equilibrium prices are defined as follows:
		\begin{align*}
		D_A &= x_0 = \frac{1}{2} - \frac{p_A - p_{B}}{2} + \frac{q_A-q_{B}}{2}\\
		D_B &= 1 - D_A\\
		p_i &= 1 + \frac{q_i - q_{-i}}{3}
		\end{align*}
	\end{lemma}
\begin{proof}
	The standard way to solve the Hotelling model is to define a marginal consumer $x_0$ i.e. a consumer who is indifferent between buying from sellers $A$ or $B$. Thus, $x_0$ is determined by the following equation: $$V+q_A-p_A - x_0 = V+q_B - p_B - (1-x_0)$$
	hence $$x_0 = \frac{1}{2} - \frac{p_A - p_B}{2} + \frac{q_A - q_B}{2}$$
	Sellers set prices $p_A, p_B$ simultaneously to solve the following problems:
	$$p_A \cdot x_0 = p_A \left(\frac{1}{2} - \frac{p_A - p_B}{2} + \frac{q_A - q_B}{2}\right) \to \underset{p_A}{\max}$$
	$$p_B \cdot (1-x_0) = p_B \left(\frac{1}{2} + \frac{p_A - p_B}{2} - \frac{q_A - q_B}{2}\right) \to \underset{p_B}{\max}$$
	The system of first order conditions is given by:
	\begin{align*}
	\begin{cases}
	p_A = \frac{1}{2} + \frac{p_B}{2} + \frac{q_A - q_B}{2}\\
	p_B = \frac{1}{2} + \frac{p_A}{2} - \frac{q_A - q_B}{2}
	\end{cases}
	\end{align*}
	Solving the system above yields $p_i = 1 + \frac{q_i - q_{-i}}{3}$
\end{proof}
	The lemma above demonstrates that without the platform the seller with the higher quality sets a higher price, and if seller $i$ decides to undercut the competitor and sets the price $p_{-i} - \varepsilon$ then the gain in additional demand will be $\frac{\varepsilon}{2}$.
	
	
	
	In the next subsection I introduce the platform.
	
	
	\subsection{Observable qualities. With the platform.}
	For simplicity, I assume firstly that $\alpha$ is fixed.
	\begin{proposition} \label{with}
		If qualities $q_A$ and $q_B$ are observable then the recommender system induces the following demands for each good and equilibrium prices:
		\begin{align*}
		D_A &= \hat{x} = \frac{1}{2} - \frac{\gamma-\alpha}{2 \gamma}(p_A - p_B) + \frac{q_A - q_B}{2}\\
		D_B &= 1 - D_A\\
		p_i &= \frac{\gamma}{\gamma - \alpha} + \frac{\gamma(q_{i} -q_{-i})}{3(\gamma-\alpha)}
		\end{align*}
		and the optimal recommender policy implies:
		\begin{itemize}
			\item recommending the seller $A$ for those customers whose location $x \le \hat{x}$
			\item recommending the seller $B$ otherwise
		\end{itemize}
	\end{proposition}
	\begin{proof}
	 The optimal recommender strategy consists of two functions $r_A(x, p_A, p_B, q_A, q_B)$, $r_B(x, p_A, p_B, q_A, q_B)$ (which for simplicity I will denote as simply $r_A(x), r_B(x)$) which are the probabilities for the customer with location $x$ to be recommended the seller $A$ and $B$ respectively. Clearly these two functions should satisfy $$0 \le r_i(x) \le 1,\ \forall\ i \in \{A, B\},\ \forall\ x \in [0, 1] $$ $$0 \le r_A(x) + r_B(x) \le 1,\ \forall\ x \in [0, 1]$$ 
	 Firstly, let me show that it is not optimal to have $r_A(x) + r_B(x) < 1$ for any $x$. Suppose on the contrary that $\exists\ x \in [0, 1], r_A(x)+r_B(x) < 1$. If for that customer any of expressions $V+q_A-p_A-x$, $V+q_B-p_B-(1-x)$ are positive then the platform can increase the probability of recommendation the seller whose good yields the customer positive utility (if both yields positive the good that yields more). Since the customer derives positive utility, $CS$ increases, this, in turn, increases the platform's objective function, hence $r_A(x) +r_B(x) < 1$ was not optimal. If both expressions $V+q_A-p_A-x$, $V+q_B-p_B-(1-x)$ are negative customer will not follow the recommendation no matter what are $r_A(x), r_B(x)$, so, without loss of generality we can restrict attention only to cases $r_A(x) + r_B(x) = 1$ i.e. to find only $r_A(x)$. 
	 
	 
	 
	 The objective of the recommender system is \begin{align*}
	 \int_{0}^1 \alpha p_A r_A(x)dx + \int_{0}^1 \alpha p_B r_B(x)dx + \gamma \biggl( \int_{0}^1 (V+q_A-p_A-x)r_A(x)dx + \\+\int_{0}^1 (V+q_B-p_B-(1-x))r_B(x)dx \biggr) = \int_0^1 (\gamma V + \gamma q_A - (\gamma - \alpha)p_A - \gamma x) r_A(x)dx +\\+ \int_0^1 (\gamma V + \gamma q_B - (\gamma - \alpha)p_B - \gamma(1- x))(1- r_A(x))dx
	 \end{align*}
	 The platform maximizes the above function subject to the constraint $0 \le r_A(x) \le 1,\ \forall\ x \in [0, 1]$. Clearly, the objective function is maximized for $$r_A(x) = \begin{cases}
	 1, \text{if the expression under the first integral is higher}\\
	 0, \text{if the expression under the second integral is higher}
	 \end{cases}$$
	 That is, the seller $A$ is recommended to customers whose locations are to the left of $$\hat{x} = \frac{1}{2} - \frac{\gamma - \alpha}{\gamma} \frac{p_A - p_B}{2} + \frac{q_A - q_B}{2}$$
	 and the seller $B$ is recommended otherwise. 
	 
	 
	 
	 
	 Given the demand, 	sellers set prices $p_A, p_B$ simultaneously to solve the following problems:
	 $$(1-\alpha)\cdot p_A \cdot \hat{x} = p_A \left(\frac{1}{2} - \frac{\gamma - \alpha}{\gamma} \frac{p_A - p_B}{2} + \frac{q_A - q_B}{2}\right) \to \underset{p_A}{\max}$$
	 $$(1-\alpha)\cdot p_B \cdot (1-\hat{x}) = p_B \left(\frac{1}{2} + \frac{\gamma - \alpha}{\gamma} \frac{p_A - p_B}{2} - \frac{q_A - q_B}{2}\right) \to \underset{p_B}{\max}$$
	 The system of first order conditions is given by:
	 \begin{align*}
	 \begin{cases}
	 p_A = \frac{\gamma}{2(\gamma - \alpha)} + \frac{p_B}{2} + \frac{\gamma(q_A - q_B)}{2(\gamma - \alpha)}\\
	 p_B = \frac{\gamma}{2(\gamma - \alpha)} + \frac{p_A}{2} - \frac{\gamma(q_A - q_B)}{2(\gamma - \alpha)}
	 \end{cases}
	 \end{align*}
	 Solving the system above yields $p_i = \frac{\gamma}{\gamma - \alpha} + \frac{\gamma(q_i - q_{-i})}{3(\gamma - \alpha)}$
	\end{proof}
	Comparing the results of the Proposition \ref{with} with Lemma \ref{without} several things are worth noting. First of all, with the recommender system the term $\frac{p_A-p_B}{2}$ in the expression for demand has an extra multiplier $\frac{\gamma-\alpha}{\gamma} \in (0, 1)$. The latter fact means that is the seller $A$ decides to undercut the competitor and sets a price $p_B - \varepsilon$, with the recommender system the resulting gain in demand will be $\frac{\gamma - \alpha}{\gamma} \frac{\varepsilon}{2}$ which is strictly below $\frac{\varepsilon}{2}$ the result we obtained for the case without the platform. That means that now the sellers have fewer incentives to undercut the competitor, i.e. the presence of recommender system which has stakes in sellers' profits softens competition. As a result, the equilibrium prices a higher. The picture below (Fig. \ref{fig1}) demonstrates graphically the impact of the recommender system. 
	
	\begin{figure}[H]
		\centering
		\includegraphics[width=0.6\textwidth]{ImpactRS}
		\caption{Impact of RS $(p_A < p_B)$}\label{fig1}
	\end{figure}
	As we can see, there exists a share of customers $\Delta = \frac{\alpha}{2 \gamma} (p_B - p_A)$ such that they strictly prefer the firm $A$ to the firm $B$ while are recommended the firm $B$. This happens since from the platform's standpoint the losses in consumer surplus are lower than gains driven by high-price sales. Note, also, that $\frac{\partial \Delta}{\partial \alpha} > 0$, $\frac{\partial \Delta}{\partial \gamma} < 0$ and $\lim_{\gamma \to \infty} \Delta = 0$. That is, the impact of the platform eliminates completely if $\gamma$ becomes very high, and the more the platform is profit-oriented (the higher is $\alpha$) the higher is $\Delta$.
	\subsection{Qualities are not observable}
	Here I consider the case when qualities $q_A, q_B$ are not observable to the platform unless the sellers decides to disclose it. In this subsection I derive the optimal recommender system of the platform. Following \cite{levin2009quality} I consider symmetric PBE in which the sellers disclose the quality if and only if the quality falls above some threshold $q^*$ and do no not disclose otherwise, and if the seller does not disclose, the beliefs of the platform regarding the quality do not depend on prices.  
	
	
	
	The optimal platform's policy can be found separately: firstly the platform may obtain the optimal recommendation (as a function of $\alpha$) treating the commission rate $\alpha$ as given, and then find an optimal commission rate. The next proposition characterize the optimal recommendation strategy given the commission rate $\alpha$.
	\begin{proposition}\label{precise}
		Given $\alpha$, the optimal recommender policy is given by $$\hat{x} = \frac{1}{2} - \frac{\gamma-\alpha}{2 \gamma}(p_A - p_B) + \frac{\tilde{q}_A - \tilde{q}_B}{2}$$
		Equilibrium prices are $$p_i = \frac{\gamma}{\gamma - \alpha} + \frac{\gamma(\tilde{q}_{i} -\tilde{q}_{-i})}{3(\gamma-\alpha)}$$ where $$\tilde{q}_i = \begin{cases}
		q_i, \text{ if firm }i\text{ discloses }\\
		\frac{q^*}{2}, \text{ otherwise}
		\end{cases}$$
		and
		\begin{align}\label{threshold}
		q^* = -\frac{5}{3} + \frac{1}{3 \gamma} \sqrt{25 \gamma^2 + \frac{216 c \gamma (\gamma - \alpha)}{1 - \alpha}}
		\end{align}
	\end{proposition} 
\begin{proof}
	From the Bayes rule it follows that if the seller does not disclose the information the platform forms beliefs that the quality is $\frac{q^*}{2}$. Given the platform's beliefs regarding the quality, the proof exactly repeats that of Proposition \ref{with}. It remains to find $q^*$. This threshold is found as the minimal quality that renders the seller indifferent between disclosing and not disclosing the information. That is, $q^*$ is determined as a solution to the following equation:
	\begin{align*}
	\mathbb{E} [\pi_i|q_i=q^*, \text{disclose}] - c = \mathbb{E} [\pi_i|q_i=q^*, \text{do not disclose}]
	\end{align*}
	\begin{align*}
	&(1-\alpha)\int_{0}^{q^*} \left(\frac{\gamma}{\gamma - \alpha} + \frac{\gamma\left(q^* - \frac{q^*}{2}\right)}{3(\gamma - \alpha)} \right) \left(\frac{1}{2} - \frac{q^* - \frac{q^*}{2}}{6}\right)dq_B +\\ &+(1-\alpha)\int_{q^*}^{1} \left(\frac{\gamma}{\gamma - \alpha} + \frac{\gamma(q^* - q_B)}{3(\gamma - \alpha)} \right) \left(\frac{1}{2} - \frac{q^* - q_B}{6}\right)dq_B - c = \\
	&=(1-\alpha)\int_{0}^{q^*} \left(\frac{\gamma}{\gamma - \alpha} + \frac{\gamma\left(\frac{q^*}{2} - \frac{q^*}{2}\right)}{3(\gamma - \alpha)} \right) \left(\frac{1}{2} - \frac{\frac{q^*}{2} - \frac{q^*}{2}}{6}\right)dq_B +\\
	&+ (1-\alpha)\int_{q^*}^{1} \left(\frac{\gamma}{\gamma - \alpha} + \frac{\gamma(\frac{q^*}{2} - q_B)}{3(\gamma - \alpha)} \right) \left(\frac{1}{2} - \frac{\frac{q^*}{2} - q_B}{6}\right)dq_B
	\end{align*}
	Solving the equation above yields
	$$q^* = -\frac{5}{3} + \frac{1}{3 \gamma} \sqrt{25 \gamma^2 + \frac{216 c \gamma (\gamma - \alpha)}{1 - \alpha}}$$
\end{proof}
Comparing this result to the optimal recommendation strategy in case of unobservable quality, we note that instead of real qualities, in all formulas are used ``perceived'' qualities i.e. the exact qualities if the firm discloses and the conditional expectation of the quality given the fact that the firm does not disclose. The threshold $q^*$ is found as a quality that renders the seller indifferent between costly disclosure and non-disclosure. The following step would be to find an optimal commission rate $\alpha$ but prior to that let me analyse the equilibrium information disclosure and how the recommender system affects it.
\begin{proposition}\label{thres}
	\begin{enumerate}[(i)]
		\item If $\gamma <1$ then $\frac{\partial q^*}{\partial \alpha} < 0$ i.e. sellers disclose more information if commissions increase
		\item If $\gamma > 1$ then $\frac{\partial q^*}{\partial \alpha} > 0$ i.e. sellers disclose less information if commissions increase
		\item If $\gamma = 1$ then $\frac{\partial q^*}{\partial \alpha} = 0$ i.e. amount of information disclosed does not depend on the commission rate
	\end{enumerate}
\end{proposition}
\begin{proof}
	The proof is straightforward, differentiating \eqref{threshold} with respect to $\alpha$, one can get:
	\begin{align*}
	\frac{\partial q^*}{\partial \alpha} = - \frac{36 c (1-\gamma)}{\sqrt{25 \gamma^2 + \frac{216 c \gamma (\gamma - \alpha)}{1 - \alpha}}} 
	\end{align*}
	which immediately implies the result.
\end{proof}
The figure below (Fig. \ref{fig2}) demonstrate the threshold $q^*$ as a function of $\alpha$.
	\begin{figure}[H]
	\centering
	\includegraphics[width=0.6\textwidth]{thres}
	\caption{$q^*$ as a function of $\alpha$}\label{fig2}
\end{figure}


Let me explain the intuition behind the Proposition \ref{thres}. A choice of $\alpha$ has several potential effects on firms' strategies. On one hand, an increase in commission rate, other things equal, decreases sellers' profits since they should pay more to the platform. This makes it less attractive to disclose the information. On the other hand, an increase in commission increases the platform's stakes in sellers' profit, hence prices and sellers' profits go up. As a result, the latter effect makes the disclosure more attractive. The total effect is determined by the platform's degree of consumer-orientedness $\gamma$. If $\gamma > 1$ the first effect prevails, i.e. an increase in prices is not enough for sellers to offset losses from higher commissions. If $\gamma < 1$ the second effect dominates, and sellers benefit more from higher prices than lose from higher commissions. If $\gamma = 1$ the two effects completely offset each other.



Finally, let me summarize the optimal recommender policy by finding an optimal commission rate $\alpha$.
\begin{proposition}\label{opt_alpha}
	\begin{enumerate}[(i)]
		\item If $\gamma < 1$ then $\frac{\partial \pi}{\partial \alpha} > 0$, so the optimal recommendation policy implies the highest commission $\alpha = \bar{\alpha}$
		\item If $\gamma > 1$ then $\frac{\partial \pi}{\partial \alpha} < 0$, so the optimal recommendation policy implies $\alpha = 0$
	\end{enumerate}
\end{proposition}
\begin{proof} Given prices $p_A, p_B$ and qualities $q_A, q_B$, total benefit of the platform is equal to:
	\begin{align*}
	\alpha(p_A \hat{x} + p_B(1-\hat{x})) + \gamma \left(\int_{0}^{\hat{x}} (V + q_A - p_A - x)dx + \int_{\hat{x}}^1 (V + q_B - p_B -(1-x))dx\right) = \\
	= 	\alpha(p_A \hat{x} + p_B(1-\hat{x})) + \gamma \left(V - \frac{1}{2}+(1-\hat{x})(q_B - p_B) + \hat{x}(q_A-p_A) - \hat{x}^2  \right)
	\end{align*}
	Where $\hat{x}$ is defined according to Proposition \ref{precise}. Hence, expected total benefit of the platform is
	\begin{align*}
	&\pi = \int_{0}^{q^*} \int_0^{q^*} \biggl( \frac{\alpha \gamma}{\gamma - \alpha} + \gamma \left(V - \frac{3}{4}+ \frac{q^*}{2} - \frac{\gamma}{\gamma - \alpha} \right)\biggr) dq_A dq_B +\\+
	 &\int_0^{q^*} \int_{q^*}^1 \biggl[ \alpha \biggl( \left( \frac{\gamma}{\gamma - \alpha} + \frac{\gamma\left( \frac{q^*}{2} - q_B \right) }{3(\gamma - \alpha)} \right)\left(\frac{1}{2} + \frac{\frac{q^*}{2} - q_B}{6} \right) + \left( \frac{\gamma}{\gamma - \alpha} - \frac{\gamma\left( \frac{q^*}{2} - q_B \right) }{3(\gamma - \alpha)} \right)\left(\frac{1}{2} - \frac{\frac{q^*}{2} - q_B}{6} \right) \biggr)+\\
	 &+\gamma \biggl(V - \frac{1}{2} + \left(\frac{1}{2} - \frac{\frac{q^*}{2} - q_B}{6} \right) \left( q_B - \frac{\gamma}{\gamma - \alpha} + \frac{\gamma \left( \frac{q^*}{2} - q_B \right)}{3 (\gamma - \alpha)} \right)  + \\
	 &+ \left(\frac{1}{2} + \frac{\frac{q^*}{2} - q_B}{6} \right) \left(\frac{q^*}{2} - \frac{\gamma}{\gamma - \alpha} - \frac{\gamma \left( \frac{q^*}{2} - q_B \right)}{3(\gamma - \alpha)} \right)  - \left( \frac{1}{2} + \frac{\frac{q^*}{2} - q_B}{6} \right)^2 \biggr)  \biggr] dq_A dq_B +\\
	 +
	 &\int_{q^*}^{1} \int_{0}^{q^*} \biggl[ \alpha \biggl( \left( \frac{\gamma}{\gamma - \alpha} + \frac{\gamma\left(q_A - \frac{q^*}{2} \right) }{3(\gamma - \alpha)} \right)\left(\frac{1}{2} + \frac{q_A - \frac{q^*}{2}}{6} \right) + \left( \frac{\gamma}{\gamma - \alpha} - \frac{\gamma\left(q_A- \frac{q^*}{2} \right) }{3(\gamma - \alpha)} \right)\left(\frac{1}{2} - \frac{q_A -\frac{q^*}{2}}{6} \right) \biggr)+\\
	 &+\gamma \biggl(V - \frac{1}{2} + \left(\frac{1}{2} - \frac{q_A-\frac{q^*}{2}}{6} \right) \left( \frac{q^*}{2} - \frac{\gamma}{\gamma - \alpha} + \frac{\gamma \left(q_A -  \frac{q^*}{2} \right)}{3 (\gamma - \alpha)} \right)  + \\
	 &+ \left(\frac{1}{2} + \frac{q_A-\frac{q^*}{2}}{6} \right) \left(q_A - \frac{\gamma}{\gamma - \alpha} - \frac{\gamma \left(q_A- \frac{q^*}{2} \right)}{3(\gamma - \alpha)} \right)  - \left( \frac{1}{2} + \frac{q_A - \frac{q^*}{2}}{6} \right)^2 \biggr)  \biggr] dq_A dq_B + \\
	 +
	  &\int_{q^*}^{1} \int_{q^*}^{1} \biggl[ \alpha \biggl( \left( \frac{\gamma}{\gamma - \alpha} + \frac{\gamma\left(q_A - q_B \right) }{3(\gamma - \alpha)} \right)\left(\frac{1}{2} + \frac{q_A - q_B}{6} \right) + \left( \frac{\gamma}{\gamma - \alpha} - \frac{\gamma\left(q_A- q_B \right) }{3(\gamma - \alpha)} \right)\left(\frac{1}{2} - \frac{q_A -q_B}{6} \right) \biggr)+\\
	 &+\gamma \biggl(V - \frac{1}{2} + \left(\frac{1}{2} - \frac{q_A-q_B}{6} \right) \left( q_B - \frac{\gamma}{\gamma - \alpha} + \frac{\gamma \left(q_A -  q_B \right)}{3 (\gamma - \alpha)} \right)  + \\
	 &+ \left(\frac{1}{2} + \frac{q_A-q_B}{6} \right) \left(q_A - \frac{\gamma}{\gamma - \alpha} - \frac{\gamma \left(q_A- q_B \right)}{3(\gamma - \alpha)} \right)  - \left( \frac{1}{2} + \frac{q_A - q_B}{6} \right)^2 \biggr)  \biggr] dq_A dq_B = \\
	 & = \frac{\gamma(216 V - q^{*3} - 161)}{216}
	\end{align*}
	Thus $$\frac{\partial \pi}{\partial \alpha} = -\frac{3 \gamma q^{*2}}{216} \frac{\partial q^*}{\partial \alpha}$$ and using the result of the Proposition \ref{thres} one may finally prove the result.
\end{proof}

The Proposition \ref{opt_alpha} demonstrates that it turns out that the highest possible commission may be not always in the platform's best interest. If $\gamma$ is high enough it is not optimal for the platform to set commission. This happens since as we see from the Proposition \ref{thres}, if the platform charges commission, sellers will disclose less information but this brings losses in $CS$ and since $\gamma$ is high, these losses do not outweight direct benefits from high commissions. 






It turns out that the optimality of the recommendation policy described in Proposition \ref{opt_alpha} strongly relies upon the assumption that the platform perfectly observes the customers' preferences (location on the line). In the next subsection this assumption is relaxed. In this scenario, there arise another effects that change the optimal recommender policy implemented by the platform.

\subsection{Not precise recommendations}
In this section I relax the assumption that the platform perfectly observes the customers' locations. A common way (see e.g. \cite{lewis1994supplying} ) to model this is to assume that prior to making a recommendation the platform can receive a noisy signal regarding the customer's location. I believe that this assumption is not very far away from reality: usually platforms collect data and implement some data-analysis tools to estimate people's preferences. Clearly, in most cases these estimates are not 100\% precise, so sometimes the platform receives a wrong signal regarding the customer's preferences.




Formally, I assume that before making recommendation to a particular customer whose true location $x$ is equal to $x_0 \in [0, 1]$ the platform receives a signal $s$ such that $$\mathbb{P}(s=x_0|x=x_0) = \beta \in [0, 1]$$ and with probability $1-\beta$, $s \sim U(0, 1)$. I will refer to $\beta$ as the recommender system precision. In this case, as it is shown by \cite{li2018recommender} the conditional expectation regarding the true location is equal to \begin{align}\label{signal}
\mathbb{E}[x|s=x_0] = \beta x_0 + \frac{1-\beta}{2}
\end{align}
The result above is quite intuitive: the higher is precision the more weight the platform assigns to the signal, while when the precision is low the platform more frequently infers that the signal is not correct and prescribes to the customer an average location $\frac{1}{2}$. 


The main goal of this subsection is to demonstrate how this recommender system's inaccuracy may affect the platform's optimal recommendation strategy and optimal commission rate.


\begin{proposition}\label{notprecise}
	Given the commission rate $\alpha$ and precision $\beta$ the optimal recommender policy implies:
	$$\hat{x} = \frac{1}{2} - \frac{\gamma - \alpha}{\gamma \beta} \frac{p_A-p_B}{2} + \frac{\tilde{q}_A - \tilde{q}_B}{2 \beta}$$
	i.e. those customers for whom signal regarding their location falls to the left of $\hat{x}$ are recommended the seller $A$, otherwise they are recommended the seller $B$.
	Equilibrium prices are
	$$p_i = \frac{\gamma}{\gamma - \alpha} \beta + \frac{\gamma(\tilde{q}_i - \tilde{q}_{-i})}{3(\gamma - \alpha)}$$
	where
	$$\tilde{q}_i = \begin{cases}
	q_i, \text{ if firm }i\text{ discloses }\\
	\frac{q^*}{2}, \text{otherwise}
	\end{cases}$$
	and $$q^* = -\frac{6 \beta - 1}{3} + \frac{1}{3 \gamma} \sqrt{(6 \beta - 1)^2\gamma^2 + \frac{216 \beta c \gamma (\gamma - \alpha)}{1-\alpha}}$$
\end{proposition}
\begin{proof}
	Using \eqref{signal} and repeating the proof of the Proposition \ref{with} one can obtain the expression for $\hat{x}$ and equilibrium prices. $q^*$ is found in the same way as in the Proposition \ref{precise}.
\end{proof}
Note that for $\beta = 1$ i.e. for the highest precision of the recommender system, we get the exact result of the Proposition \ref{precise}. Several observations are worth noting from the Proposition above. First of all, low precision makes the impact of the recommender system less prominent. We have a multiplier $\frac{\gamma - \alpha}{2 \gamma \beta}$ before the term $(p_A - p_B)$ in the threshold which determines the demand for sellers. The lower is $\beta$ the stronger becomes incentives for the sellers to undercut the competitor. This can be explained in the following way: now there is a chance that the platform mistakes regarding the location of the customer, in this case, the platform makes a recommendation assuming that it is an average customer (location $\frac{1}{2}$). The latter increases the share of customers in the middle whom the sellers have the highest incentives to compete for. As a result, other things equal, equilibrium prices are lower, the less precise is the recommender system implemented by the platform.




Interestingly, qualitatively the behavior of the threshold $q^*$ as a function of $\alpha$ does not depend on the fact that the recommender system is not precise. That is, the Proposition \ref{thres} is true even if $\beta < 1$.


However, it turns out that depending on cost of information disclosure, the amount of information disclosed in equilibrium depends differently on the recommender system precision.



\begin{proposition}\label{thres_beta}
	\begin{enumerate}[(i)]
		\item If $c \le \frac{\gamma(1-\alpha)}{9(\gamma - \alpha)}$ then $q^* \in [0, 1]$ and $\frac{\partial q^*}{\partial \beta} \le 0$ i.e. sellers disclose more information if the recommender system is more precise
		\item If $\frac{\gamma(1-\alpha)}{9(\gamma - \alpha)} < c \le \frac{13}{8}\frac{\gamma(1-\alpha)}{9(\gamma - \alpha)}$ then $q^* \in [0, 1]$ and $\frac{\partial q^*}{\partial \beta} > 0$ i.e. sellers disclose less information if the recommender system is more precise
		\item If $c > \frac{13}{8}\frac{\gamma(1-\alpha)}{9(\gamma - \alpha)}$ then $\frac{\partial q^*}{\partial \beta} > 0$ and $q^* \in [0, 1] \iff 0 \le \beta \le \frac{\gamma(1-\alpha)}{72 c (\gamma - \alpha) - 12 \gamma (1-\alpha)}$ 
	\end{enumerate}
\end{proposition}
\begin{proof}
	First of all, let us find a condition that guarantees that $q^* \le 1$. 
	\begin{align*}
	\sqrt{(6 \beta - 1)^2 \gamma^2 + \frac{216 \beta c \gamma (\gamma - \alpha)}{1-\alpha}} &\le 2\gamma (1+3 \beta)\\
	-\gamma(1+12 \beta) + \frac{72 \beta c (\gamma - \alpha)}{1 - \alpha} &\le 0\\
	\beta &\le \frac{\gamma(1-\alpha)}{72c (\gamma - \alpha) - 12 \gamma (1-\alpha)}
	\end{align*}
	Clearly, if $\frac{\gamma(1-\alpha)}{72c (\gamma - \alpha) - 12 \gamma (1-\alpha)} > 1$, $q^* \le 1$ for all $\beta$. Thus, 
	\begin{align*}
	\frac{\gamma(1-\alpha)}{72c (\gamma - \alpha) - 12 \gamma (1-\alpha)} &> 1\\
	\frac{13}{72} \frac{\gamma(1-\alpha)}{\gamma - \alpha} &> c
	\end{align*}
	Differentiated the expression for $q^*$ with respect to $\beta$ yields:
	\begin{align*}
	\frac{\partial q^*}{\partial \beta} = -2 + \frac{2 \gamma (6 \beta - 1) + \frac{36 c (\gamma - \alpha)}{1-\alpha}}{ \sqrt{(6 \beta - 1)^2\gamma^2 + \frac{216 \beta c \gamma (\gamma - \alpha)}{1-\alpha}}}
	\end{align*} 
	\begin{align*}
	-2 + \frac{2 \gamma (6 \beta - 1) + \frac{36 c (\gamma - \alpha)}{1-\alpha}}{ \sqrt{(6 \beta - 1)^2\gamma^2 + \frac{216 \beta c \gamma (\gamma - \alpha)}{1-\alpha}}} &\le 0 \iff\\
	\iff \gamma(6 \beta - 1) + \frac{18c(\gamma - \alpha)}{1- \alpha} &\le \sqrt{(6 \beta - 1)^2\gamma^2 + \frac{216 \beta c \gamma (\gamma - \alpha)}{1-\alpha}} \iff\\
	\iff 36 \gamma (6 \beta - 1)(1-\alpha) + 18^2 c(\gamma - \alpha) &\le 216 \beta \gamma (1-\alpha) \iff\\
	\iff c &\le \frac{\gamma(1 - \alpha)}{9(\gamma - \alpha)}  
	\end{align*} 
	This completes the proof.
\end{proof}


What drives the result above? The recommender system's precision has several effects on sellers: on one hand, as we see from the Proposition \ref{notprecise} higher precision means softer competition and as a result higher prices, and hence more incentives for sellers to disclose the information. On the other hand, high $\beta$ renders the contribution of quality into demand lower (we have the term $\frac{\tilde{q}_i - \tilde{q}_{-i}}{2 \beta}$) in the demand for the seller's $i$ good. As a result, with high precision the impact of quality decreases, which makes sellers less willing to bear cost of disclosure. That is why, if cost of disclosure is high the latter effect dominates and improving the recommender system's precision adversely effects the amount of information disclosed in the equilibrium. If, on the other hand, cost of disclosure is small, higher precision increases the amount of disclosed information. 



This ambiguous influence of the precision on the amount of information disclosed, qualitatively changes an impact of commission rate on the platform's total benefit. Assuming that the recommendation precision $\beta$ is an exogenous constant, the next proposition describes the optimal policy of the platform regarding commissions it charges sellers.



\begin{proposition}\label{profit_beta}
	\leavevmode 
	\begin{itemize}
		\item If $\beta \le 0.5$ and  $\gamma > 1$ then $\frac{\partial \pi }{\partial \alpha} > 0$ and the optimal commission is $\alpha = \bar{\alpha}$
		\item  If $\beta \le 0.5$ and $\gamma < 1$ then $\frac{\partial \pi }{\partial \alpha} < 0$ and the optimal commission is $\alpha = 0$	
		\item If $\beta > 0.5$ and  $\gamma > 1$ then $\frac{\partial \pi }{\partial \alpha} < 0$ and the optimal commission is $\alpha = 0$
		\item If $\beta > 0.5$ and $\gamma < 1$ then $\frac{\partial \pi }{\partial \alpha} > 0$ and the optimal commission is $\alpha = \bar{\alpha}$
	\end{itemize}
\end{proposition}
\begin{proof}
 First of all, we need to find the platform's expected profit. Given prices $p_A, p_B$ and qualities $q_A, q_B$, total benefit of the platform is equal to:
 \begin{align}\label{profit}
 \alpha(p_A \hat{x} + p_B(1-\hat{x})) + \gamma \biggl(\int_{0}^{\hat{x}} \biggl[ (\beta +(1-\beta)\hat{x})(V + q_A - p_A - x) + \nonumber \\+ (1-\beta)(1-\hat{x})(V + q_B - p_B - (1-x))\biggr]dx + \int_{\hat{x}}^1 \biggl[(1-\beta) \hat{x}(V+q_A-p_A-x) + \nonumber\\
 +(\beta + (1-\beta)(1-\hat{x}))(V + q_B - p_B -(1-x)) \biggr] dx\biggr) = \\
 = 	\alpha(p_A \hat{x} + p_B(1-\hat{x})) + \gamma \left(V - \frac{1}{2}+(1-\hat{x})(q_B - p_B) + \hat{x}(q_A-p_A) + \beta \hat{x} - \beta \hat{x}^2  \right)\nonumber
 \end{align}
 Where $\hat{x}$ is defined according to Proposition \ref{notprecise}. For those customers located to the left of $\hat{x}$ the probability of being recommended a seller $A$ is $\beta + (1-\beta) \hat{x}$. Since with probability $\beta$ the platform receives the true location of customer and with probability $(1-\beta) \hat{x}$ the platform receives a signal from the interval $[0, \hat{x}]$. In the following way, one can obtain probabilities of being recommended seller $B$ for those customers located to the left of $\hat{x}$ as well as probabilities of being recommended sellers $A$ and $B$ for the customers located to the right of $\hat{x}$. Finally, we obtain an expression in \eqref{profit}. Then, in the same way as in the Proposition \ref{opt_alpha} one can obtain the expression for the profit:
 \begin{align*}
 \pi = \frac{\gamma(54 \beta^2(1+4V) - (1-q^{*3})(1-2\beta) - 216 \beta^3)}{216 \beta^2}
 \end{align*}
 Thus, \begin{align*}
 \frac{\partial \pi }{\partial \alpha} = \frac{\gamma q^{*2}(1-2\beta)}{72 \beta^2} \frac{\partial q^*}{\partial \alpha}
 \end{align*}
 Using the result of the Proposition \ref{thres} we finally obtain the result we were to prove.
\end{proof}
In contrast to the case with precise recommendation system (Proposition \ref{precise}), if the platform's precision is not very high (lower than 0.5), it may be optimal to charge maximal commission even in case when $\gamma > 1$. This happens since with very low precision the weight of quality for the recommendation becomes higher, as a result, sellers have incentives to reveal quality even with high commissions. In the similar fashion can be explained the fact that for low precision not very consumer-oriented recommender system (with $\gamma < 1$) prefers to set $\alpha = 0$: low precision adversely affects the consumer surplus, the situation deteriorates if in addition sellers decide not to disclose the information. Consequently, it is optimal for the platform to set $\alpha = 0$.
	\section{Discussion}
	\section{Extensions}
	\section{Conclusion}
	\newpage
	\bibliography{lib}{}
	%\bibliographystyle{unsrt}
	%\bibliographystyle{apalike}
	\bibliographystyle{abbrvnat}
\end{document}